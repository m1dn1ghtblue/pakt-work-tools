# PAKT Work Tools
Комплекс инструментов (библиотека) для работы с петрозаводским аннотированным корпусом.

## Цель и миссия
Библиотека предназначена для накопления корпуса ученических текстов, аннотирования текстов
и определения степени грубости ошибки и выставления общей оценки за ученический текст
на немецком языке, исходя из настраиваемой шкалы оценивания.
Библиотека реализует функции, которые традиционно выполняются преподавателем:
интерпретация лингвистических ошибок в тексте обучающегося на предмет ее грубости и обобщение результатов в виде общей оценки за весь текст.  

Разработанная библиотека может быть использована для:
1. Создания информационных систем автоматизации деятельности преподавателей иностранных языков;
2. Проведения научных исследований в области аттестации обучающихся иностранному языку.

В частности, библиотека была использована участниками для подготовки статьи “Котюрова И.А. Корпус студенческих текстов на немецком языке как источник данных для образования и науки [Текст] / И.А. Котюрова, Л.В. Щеголева // Вопросы образования. - Москва, 2022. - №4. - С.322-349. - Режим доступа: https://vo.hse.ru/article/view/16526/15535”.

## Возможности
### Аннотирование корпуса
Загрузка текстов и аннотирование выполняется через веб интерфейс инструментария.

* Возможности преподавателя
  * Загрузка работ от лица студента
  * Просмотр и удаление любых работ
  * Аннтирование всех текстов
  * ~~Возможность давать доступ студентам для аннотирования текста~~

* Возможности студента
  * Загрузка новых работ от своего лица
  * Просмотр и удаление только своих работ
  * ~~Аннотация только разрешенных текстов~~

Инструкция по установки и настройке инструментария описана в разделе [Установка](#установка).
Инструкция по работе с веб интерфейсом аннотирования корпуса описана в [docs/guide.md](docs/guide.md).


### Поиск по корпусу
Модуль search_app предоставляет пользователю интерфейс для поиска по корпусу с использованием языка [Corpus Query Language](https://www.sketchengine.eu/documentation/corpus-querying/).
Документация по поиску размещена в файле [docs/cql.md](docs/cql.md). 

### Выгрузка корпуса
Документация и скрипты для выгрузки корпуса размещены в [каталоге модуля](csv-dump).
Текущая версия выгруженного корпуса размещена в [Hugging Face](https://huggingface.co/datasets/remshu-inc/marks).

### Модуль построения оценок
Документация и скрипты обучения и использования модуля построения оценок размещены в [каталоге модуля](grading_module).

### Выгрузка предобученных моделей
Документация и примеры скриптов выгрузки предобученных моделей размещены в [каталоге модуля построения оценок](grading_module).
Текущая версия предобученной модели определения грубости ошибки размещена в [Hugging Face](https://huggingface.co/remshu-inc/mencoder).
Текущая версия предобученной модели оценки текста размещена в [Hugging Face](https://huggingface.co/remshu-inc/mencoder).

## Системные требования
Для запуска библиотеки требуется ЭВМ с 64-битной архитектурой и установленным
интерпретатором языка Python версии не ниже 3.9.
Обучение нейронных сетей выполняется с помощью библиотек Torch и Tensorflow и
требует не менее 10Гб ОЗУ или использования соответствующих графических видеоускорителей.
Для использования библиотеки с обученными нейронными сетями требуется ЭВМ с 64-битной
архитектурой н не менее 8Гб ОЗУ.

## Установка
**Пре-установка**
1. Установите [GIT](https://git-scm.com/downloads)
2. Установите [Python3](https://www.python.org/downloads/)
3. Установите и настройте [MySQL Server](https://dev.mysql.com/downloads/mysql/)


**Установка**
1. Создайте папку для проекта
2. Установите виртуальное окружение `pip install virtualenv`
3. Создайте виртуальное окружение pakt `python -m venv pakt`
4. Создайте пустую базу данных без структуры
5. Запустите виртуальное окружение
(Для Windows:`.\pakt\Scripts\Activate.ps1`)
6. Склонируйте проект с git
`git clone https://github.com/remshu/pakt-work-tools.git` и перейдите в папку
7. Установите все требуемые библиотеки
`pip install -r requirements.txt`
8. Создайте необходимые директории `python create_folders.py`
9. Выберите или задайте путь к папкам временных файлов в `pakt_work_tools\settings.py`, раздел `Other settings`
```
#Other settings

SEARCH_TMP_FOLDER_LOCAL = 'search_app/tmp/'
SEARCH_TMP_FOLDER_SERVER = 'var/www/lingo/pakt-work-tools/search_app/tmp/'
SEARCH_TMP_FOLDER = SEARCH_TMP_FOLDER_SERVER
```
10. Измените данные для работы с БД в `pakt_work_tools\settings.py`
```
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'name',
        'USER': 'root',
        'PASSWORD': 'password',
        'HOST': '127.0.0.1',
        'PORT': '3306',
        'CHARSET': 'utf8mb4',
    }
}
```
 * ENGINE - Встроенная сервернная база данных для использования(оставить как есть)
 * NAME - Имя созданной базы данных из пункта 4
 * USER - Имя пользователя, используемое при установке и настройки системы управления базами данных
 * PASSWORD - Пароль пользователя, используемый при установке и настройки системы управления базами данных
 * HOST - Хост, который используется при подключении к базе данных(по умолчанию: 127.0.0.1)
 * PORT - Порт, используемый при установке и настройки системы управления базами данных(по умолчанию: 3306)
11. Создание миграций:
	1. Если папка `migrations` пуста или отсутствует:
    	1. `python manage.py makemigrations text_app`
		2. `python manage.py makemigrations user_app`
		3. `python manage.py makemigrations right_app`
		4. `python manage.py makemigrations search_app`
	2. Иначе выполните скрипт `python drop_migrations.py` и выполните пункт 11.1
12. Запустите миграцию
`python manage.py migrate`
13. При наличии дампа базы данных восстановите его в подключенную к сервису базу данных
14. Запустите сервер `python manage.py runserver`

## ***Дополнительно***
### *Создание корректного дампа базы данных:*
```
mysqldump -uuser -ppassword database_name --no-tablespaces --complete-insert --no-create-info --lock-tables=True --routines --ignore-table=lingo.auth_group --ignore-table=lingo.auth_group_permissions --ignore-table=lingo.auth_permission --ignore-table=lingo.django_admin_log --ignore-table=lingo.django_content_type --ignore-table=lingo.django_migrations --ignore-table=lingo.django_session  > dump.sql
```
### *Восстановление дампа базы данных:*
```
mysql -uuser -ppassword database_name < dump.sql
```

### *Ошибка запуска вирт.окружения:*
CategoryInfo          : Ошибка безопасности: (:) [], PSSecurityException
FullyQualifiedErrorId : UnauthorizedAccess

Решение проблемы:
- Открываем терминал PowerShell от админа.
- Вставляем и запускаем - Set-ExecutionPolicy RemoteSigned
- На вопрос отвечаем - A

### Автоматическое тестирование кода библиотеки
Запуск тестов осуществляется средствами Django:
```shell
python3 manage.py test
```
Для сохранения тестовой базы данных можно воспользоваться ключем `--keepdb`.
Оценка покрытия выполняется с помощью утилиты coverage:
```shell
coverage run --source='.' manage.py test --keepdb
coverage html --omit="search_app/*"
```
